image: docker:latest

services:
        - docker:dind

stages:
        - build
        - test
        - deploy

DISTRO=ubuntu RUNTIME=legion DOCKERHUB=true:
        stage: build

        variables:
          GLOBAL_CI_VARIABLE: "global_ci_value"
          GIT_SUBMODULE_STRATEGY: recursive


        before_script:
                - mkdir /builds/onurcaylak/flecsi/artifacts

        script:
                - bash script.sh ubuntu legion true #DISTRO RUNTIME DOCKERHUB
                 
        artifacts:
                expire_in: 1 hour
                paths:
                        - /builds/onurcaylak/flecsi/artifacts
                                                     
test_ubuntu:
        stage: test
        script: 
                - cd /builds/onurcaylak/flecsi/artifacts/flecsi/build
                - make test ARGS="-V"
        dependencies:
                - DISTRO=ubuntu RUNTIME=legion DOCKERHUB=true

        artifacts:
                expire_in: 1 hour
                paths:
                        - /builds/onurcaylak/flecsi/artifacts
                                                     
