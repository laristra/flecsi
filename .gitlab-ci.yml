stages:
        - build
        - test
        - deploy

before_script:
        - git config remote.origin.fetch "+refs/heads/*:refs/remotes/origin/*"
        - git fetch --unshallow && git fetch --tags #for versioning

DISTRO=ubuntu RUNTIME=legion DOCKERHUB=true:
        stage: build
        script:
        - DISTRO=ubuntu RUNTIME=legion DOCKERHUB=true
        - cp -vr docker ${HOME}/docker
        - sed -i "1s/fedora/${DISTRO}/" ${HOME}/docker/Dockerfile
        - cd ../../
        - echo  ${TRAVIS_REPO_SLUG}
        - mv -v ${CI_ENVIRONMENT_SLUG} $HOME/docker
        - cp -r $HOME/.ccache ${HOME}/docker/ccache
        - cp -r $HOME/.sonar ${HOME}/docker/sonar
        - if [[ ${CC} != gcc ]]; then TAG="_${CC}"; fi
        - if [[ ${CI_COMMIT_REF_NAME} != stable ]]; then TAG="${TAG}_${TRAVIS_BRANCH//\//_}"; fi

