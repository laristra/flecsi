<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" type="image/x-icon" href="flecsi-favicon.ico" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<title>Interface Documentation: FleCSI: Tutorial - 05 Dense Data</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" height="200" style="margin-top:40px; margin-left:30px; margin-right:10px" src="medium-flecsi.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Interface Documentation<br>
		<span id="projectnumber">Version:</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">FleCSI: Tutorial - 05 Dense Data </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Dense Data</h1>
<p>The FleCSI data model provides several different storage types. A storage type is a formal term that implies a particular logical layout to the data of types registered under it. The <em>logical</em> layout of the data provides the user with an interface that is consistent with a particular view of the data. In this example, we focus on the <em>dense</em> storage type.</p>
<p>Logically, dense data may be represented as a contiguous array, with indexed access to its elements. The dense storage type interface is similar to a C array or std::vector, with element access provided through the *()* operator, i.e., if var has been registered as a dense data type, it may be accessed like: <em>var(0)</em>, <em>var(1)</em>, etc.</p>
<p>In the <em>fields</em> example (04-fields), we were actually using the dense storage type to represent an array of double defined on the cells of our specialization mesh. This example is an extension that demonstrates using user-defined types as dense field data.</p>
<p>This example uses a user-defined struct as the dense data type. The <em>struct_type_t</em> is defined in the <em>types.h</em> file:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dense__accessor_8h.html">flecsi/data/dense_accessor.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">namespace </span><a class="code" href="namespacetypes.html">types</a> {</div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceflecsi.html">flecsi</a>;</div><div class="line"></div><div class="line"><span class="comment">// This is the definition of the struct_type_t type.</span></div><div class="line"></div><div class="line"><span class="keyword">struct </span>struct_type_t {</div><div class="line">  <span class="keywordtype">double</span> a;</div><div class="line">  <span class="keywordtype">size_t</span> b;</div><div class="line">  <span class="keywordtype">double</span> v[3];</div><div class="line">}; <span class="comment">// struct_type_t</span></div><div class="line"></div><div class="line"><span class="comment">// Here, we define an accessor type to use in the task signatures in our</span></div><div class="line"><span class="comment">// example. Notice that the base type &quot;dense_accessor&quot; takes four</span></div><div class="line"><span class="comment">// parameters. The first parameter is the type that has been registered on</span></div><div class="line"><span class="comment">// the associated index space. The other three parameters specify the</span></div><div class="line"><span class="comment">// privileges with which the corresponding data will be accessed.</span></div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;</div><div class="line">  <span class="keywordtype">size_t</span> SHARED_PRIVILEGES&gt;</div><div class="line"><span class="keyword">using</span> struct_field = <a class="code" href="structflecsi_1_1accessor__u_3_01data_1_1dense_00_01T_00_01EXCLUSIVE__PERMISSIONS_00_01SHARED__PEb133ab9348c8454ebc6464fc890c46f5.html">dense_accessor&lt;struct_type_t, rw, SHARED_PRIVILEGES, ro&gt;</a>;</div><div class="line"></div><div class="line">} <span class="comment">// namespace types</span></div></div><!-- fragment --><p>Aside from using a struct type, this example of registering data is identical to registering a fundamental type, e.g., double or size_t.</p>
<p>The code for this example can be found in <em>dense.cc</em>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include&lt;flecsi-tutorial/specialization/mesh/mesh.h&gt;</span></div><div class="line"><span class="preprocessor">#include&lt;<a class="code" href="data_8h.html">flecsi/data/data.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include&lt;<a class="code" href="execution_8h.html">flecsi/execution/execution.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;types.h&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceflecsi.html">flecsi</a>;</div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceflecsi_1_1tutorial.html">flecsi::tutorial</a>;</div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacetypes.html">types</a>;</div><div class="line"></div><div class="line"><a class="code" href="group__data.html#gaaa855ccd1c709526c76247bce774ff64">flecsi_register_data_client</a>(<a class="code" href="structflecsi_1_1tutorial_1_1specialization__mesh__t.html">mesh_t</a>, clients, mesh);</div><div class="line"><a class="code" href="group__data.html#ga94367ffbedff524f08ddef3a27df2b36">flecsi_register_field</a>(<a class="code" href="structflecsi_1_1tutorial_1_1specialization__mesh__t.html">mesh_t</a>, <a class="code" href="namespacetypes.html">types</a>, f, struct_type_t, dense, 1, cells);</div><div class="line"></div><div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceexample.html">example</a> {</div><div class="line"></div><div class="line"><span class="comment">// This task initializes the field of struct_type_t data. Notice that</span></div><div class="line"><span class="comment">// nothing has changed about the iteration logic over the mesh. The only</span></div><div class="line"><span class="comment">// difference is that now the dereferenced values are struct instances.</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> initialize_field(<a class="code" href="structflecsi_1_1data__client__handle__base__u.html">mesh&lt;ro&gt;</a> mesh, struct_field&lt;rw&gt; f) {</div><div class="line">  <span class="keywordflow">for</span>(<span class="keyword">auto</span> c: mesh.cells(owned)) {</div><div class="line">    f(c).a = double(c-&gt;id())*1000.0;</div><div class="line">    f(c).b = c-&gt;id();</div><div class="line">    f(c).v[0] = double(c-&gt;id());</div><div class="line">    f(c).v[1] = double(c-&gt;id())+1.0;</div><div class="line">    f(c).v[2] = double(c-&gt;id())+2.0;</div><div class="line">  } <span class="comment">// for</span></div><div class="line">} <span class="comment">// initialize_field</span></div><div class="line"></div><div class="line"><a class="code" href="group__execution.html#ga4dcd75ac370388c816b99672d589c4bc">flecsi_register_task</a>(initialize_field, <a class="code" href="namespaceexample.html">example</a>, loc, single);</div><div class="line"></div><div class="line"><span class="comment">// This task prints the struct values.</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> print_field(<a class="code" href="structflecsi_1_1data__client__handle__base__u.html">mesh&lt;ro&gt;</a> mesh, struct_field&lt;ro&gt; f) {</div><div class="line">  <span class="keywordflow">for</span>(<span class="keyword">auto</span> c: mesh.cells(owned)) {</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;cell id: &quot;</span> &lt;&lt; c-&gt;id() &lt;&lt; <span class="stringliteral">&quot; has value: &quot;</span> &lt;&lt; std::endl;</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;\ta: &quot;</span> &lt;&lt; f(c).a &lt;&lt; std::endl;</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;\tb: &quot;</span> &lt;&lt; f(c).b &lt;&lt; std::endl;</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;\tv[0]: &quot;</span> &lt;&lt; f(c).v[0] &lt;&lt; std::endl;</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;\tv[1]: &quot;</span> &lt;&lt; f(c).v[1] &lt;&lt; std::endl;</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;\tv[2]: &quot;</span> &lt;&lt; f(c).v[2] &lt;&lt; std::endl;</div><div class="line">  } <span class="comment">// for</span></div><div class="line">} <span class="comment">// print_field</span></div><div class="line"></div><div class="line"><a class="code" href="group__execution.html#ga4dcd75ac370388c816b99672d589c4bc">flecsi_register_task</a>(print_field, <a class="code" href="namespaceexample.html">example</a>, loc, single);</div><div class="line"></div><div class="line">} <span class="comment">// namespace example</span></div><div class="line"></div><div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceflecsi.html">flecsi</a> {</div><div class="line"><span class="keyword">namespace </span>execution {</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="hpx_2runtime__driver_8h.html#a529faee76b6bf740ce1a013919b3654f">driver</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** argv) {</div><div class="line"></div><div class="line">  <span class="keyword">auto</span> m = <a class="code" href="group__data.html#ga9673dfe687ab0a65683d20689bd9cc46">flecsi_get_client_handle</a>(<a class="code" href="structflecsi_1_1tutorial_1_1specialization__mesh__t.html">mesh_t</a>, clients, mesh);</div><div class="line"></div><div class="line">  <span class="comment">// The interface for retrieving a data handle now uses the</span></div><div class="line">  <span class="comment">// struct_type_t type.</span></div><div class="line"></div><div class="line">  <span class="keyword">auto</span> f = <a class="code" href="group__data.html#gaa8a47aa981f998c81433eece3206e5f0">flecsi_get_handle</a>(m, <a class="code" href="namespacetypes.html">types</a>, f, struct_type_t, dense, 0);</div><div class="line"></div><div class="line">  <a class="code" href="group__execution.html#gafca967e833f6d2dffd7d326c5993964f">flecsi_execute_task</a>(initialize_field, <a class="code" href="namespaceexample.html">example</a>, single, m, f);</div><div class="line">  <a class="code" href="group__execution.html#gafca967e833f6d2dffd7d326c5993964f">flecsi_execute_task</a>(print_field, <a class="code" href="namespaceexample.html">example</a>, single, m, f);</div><div class="line"></div><div class="line">} <span class="comment">// driver</span></div><div class="line"></div><div class="line">} <span class="comment">// namespace execution</span></div><div class="line">} <span class="comment">// namespace flecsi</span></div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
