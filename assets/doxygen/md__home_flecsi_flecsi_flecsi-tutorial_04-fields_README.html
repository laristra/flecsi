<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" type="image/x-icon" href="flecsi-favicon.ico" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<title>Interface Documentation: FleCSI: Tutorial - 04 Fields</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" height="200" style="margin-top:40px; margin-left:30px; margin-right:10px" src="medium-flecsi.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Interface Documentation<br>
		<span id="projectnumber">Version:</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">FleCSI: Tutorial - 04 Fields </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Fields</h1>
<p>In FleCSI, a field is a logical array that is defined on an index space. The elements of the field are defined through a template argument, so that, with some restrictions, a field element can be any P.O.D. or user-defined type.</p>
<p>Fields must be registered with the FleCSI runtime. This is somewhat analogous to defining a variable in C++, except that variables in FleCSI must be associated with an index space, i.e., they must be registered <em>against</em> a valid index space of a specific data client. Internally, this is similar to what one would do if they had a class or struct type (the data client) in C++ and wanted to add a data member (the field) to it. FleCSI uses some metaprogramming techniques and the FleCSI data model to define field data. Field registration must occur at file scope, i.e., outside of any executable code sections, and must specify a compile-time type and index space. The arguments to the field registration interface are:</p>
<ol type="1">
<li>The data client type. This must be a valid FleCSI data client (These are defined by the specialization layer.) In this example, the data client is <em>mesh_t</em>.</li>
<li>The namespace of the field. This does not need to be an actual C++ namespace. This parameter is used to avoid naming collisions. In this example, the namespace is <em>example</em>.</li>
<li>The field name. This is an arbitrary name created by the user to identify the field. It can be any legal C++ variable name. In this example, the field name is <em>field</em>.</li>
<li>The data type. As stated above, this can be a P.O.D. or user-defined type. The restrictions on this type are listed in the <em>NOTES</em> section below. In this example, the data type is <em>double</em>.</li>
<li>The storage class of the field. Storage class identifiers give the FleCSI runtime additional information about the logical structure of a field. They also define the interface that is available to the user for accessing the field data. Storage classes are covered in additional detail in a later example. In this example, the storage class is <em>dense</em>. The dense storage class is logically a contiguous array with one entry per index in the associated index space.</li>
<li>The number of versions to register. FleCSI field data support multiple versions of the data that are registered with a given namespace and name. This is useful for multi-step methods that require storage of multiple previous states, as well as other methods where it makes sense to store multiple copies of an array under a single name.</li>
<li>The index space. This must be a valid index space that is exposed by the data client type passed in argument 1. In this example, the index space is <em>cells</em>.</li>
</ol>
<p>Users reference fields using a handle and an iterator of the corresponding index space on which the field was registered. The current interface is somewhat complicated and bears further discussion:</p>
<p>Logically, users <em>define</em> a task with arguments that may be a mixture of by-value data, which are copied directly through the calling chain and do not need to be registered with the FleCSI runtime, and data accessors, which are types defined by the specialization or end-user that correspond to registered field types. Notice that <em>define</em> is emphasized in the previous sentence. This is to highlight the fact that the definition of the task interface takes <em>accessors</em>, while the <em>execution</em> of the task takes <em>handles</em>. Handles are opaque objects that are returned to the end-user by calls to the handle interface. These should generally use anonomous typeing, i.e., they should use the <em>auto</em> keyword. The closest analogue in C++ to this paradigm is the passage of variables <em>by-reference</em>, in which , a function or method is defined to take a reference, but the user simply passes a variable instance. The compiler automatically inserts logic to pass a reference to the variable rather than copying it. Similarly, handles that are passed to the FleCSI execution interface are automatically mapped to the associated accessor type by the runtime, such that, from the point of view of the executing task, the parameter is an accessor.</p>
<p>The handle interface takes the following arguments:</p>
<ol type="1">
<li>An instance of the data client against which the field was registered. Recall that registering a field is logically similar to adding a data member to a type. Passing a data client instance tells the runtime for which type instance the field should be returned. Because fields are stateful, there must be one field instance for each data client instance of the associated client type. Nominally, allocation of field data is lazy, such that a client instance for which a particular field is never accessed, never allocates the field. In this example, the data client instance is <em>m</em>.</li>
<li>The namespace of the field. In this example, the namespace is <em>example</em>.</li>
<li>The field name. In this example, the field name is <em>field</em>.</li>
<li>The data type. In this example, the data type is <em>double</em>.</li>
<li>The storage class of the field. In this example, the storage class is <em>dense</em>.</li>
<li>The version number of the field. This index is <em>zero-based</em>. In this example, the version is <em>0</em>.</li>
</ol>
<p>NOTES:</p>
<ul>
<li>Field types may not reference arbitrary data, i.e., they cannot contain pointers to other data. Another way of saying this, is that all subtypes of a field must have a size that can be statically determined.</li>
<li>The data client handle <em>m</em> and the field handle <em>f</em> are passed to the execution interface in the same order that they appear in the task definition.</li>
</ul>
<p>The code for this example can be found in <em>fields.cc</em>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include&lt;flecsi-tutorial/specialization/mesh/mesh.h&gt;</span></div><div class="line"><span class="preprocessor">#include&lt;<a class="code" href="data_8h.html">flecsi/data/data.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include&lt;<a class="code" href="execution_8h.html">flecsi/execution/execution.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceflecsi.html">flecsi</a>;</div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceflecsi_1_1tutorial.html">flecsi::tutorial</a>;</div><div class="line"></div><div class="line"><span class="comment">// This call registers a field called &#39;field&#39; against a data client</span></div><div class="line"><span class="comment">// with type &#39;mesh_t&#39; on the index space &#39;cells&#39;. The field is in the</span></div><div class="line"><span class="comment">// namespace &#39;example&#39;, and is of type &#39;double&#39;. The field has storage</span></div><div class="line"><span class="comment">// class &#39;dense&#39;, and has &#39;1&#39; version.</span></div><div class="line"></div><div class="line"><a class="code" href="group__data.html#ga94367ffbedff524f08ddef3a27df2b36">flecsi_register_field</a>(<a class="code" href="structflecsi_1_1tutorial_1_1specialization__mesh__t.html">mesh_t</a>, <a class="code" href="namespaceexample.html">example</a>, <a class="code" href="structflecsi_1_1accessor__u_3_01data_1_1dense_00_01T_00_01EXCLUSIVE__PERMISSIONS_00_01SHARED__PEb133ab9348c8454ebc6464fc890c46f5.html">field</a>, <span class="keywordtype">double</span>, dense, 1, cells);</div><div class="line"></div><div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceexample.html">example</a> {</div><div class="line"></div><div class="line"><span class="comment">// This task takes mesh and field accessors and initializes the</span></div><div class="line"><span class="comment">// field with the id of the cell on which it is defined.</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> initialize_field(<a class="code" href="structflecsi_1_1data__client__handle__base__u.html">mesh&lt;ro&gt;</a> mesh, <a class="code" href="structflecsi_1_1accessor__u_3_01data_1_1dense_00_01T_00_01EXCLUSIVE__PERMISSIONS_00_01SHARED__PEb133ab9348c8454ebc6464fc890c46f5.html">field&lt;rw&gt;</a> f) {</div><div class="line">  <span class="keywordflow">for</span>(<span class="keyword">auto</span> c: mesh.cells(owned)) {</div><div class="line">    f(c) = double(c-&gt;id());</div><div class="line">  } <span class="comment">// for</span></div><div class="line">} <span class="comment">// initialize_field</span></div><div class="line"></div><div class="line"><span class="comment">// Task registration is as usual...</span></div><div class="line"></div><div class="line"><a class="code" href="group__execution.html#ga4dcd75ac370388c816b99672d589c4bc">flecsi_register_task</a>(initialize_field, <a class="code" href="namespaceexample.html">example</a>, loc, single);</div><div class="line"></div><div class="line"><span class="comment">// This task prints the field values.</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> print_field(<a class="code" href="structflecsi_1_1data__client__handle__base__u.html">mesh&lt;ro&gt;</a> mesh, <a class="code" href="structflecsi_1_1accessor__u_3_01data_1_1dense_00_01T_00_01EXCLUSIVE__PERMISSIONS_00_01SHARED__PEb133ab9348c8454ebc6464fc890c46f5.html">field&lt;ro&gt;</a> f) {</div><div class="line">  <span class="keywordflow">for</span>(<span class="keyword">auto</span> c: mesh.cells(owned)) {</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;cell id: &quot;</span> &lt;&lt; c-&gt;id() &lt;&lt; <span class="stringliteral">&quot; has value &quot;</span> &lt;&lt;</div><div class="line">      f(c) &lt;&lt; std::endl;</div><div class="line">  } <span class="comment">// for</span></div><div class="line">} <span class="comment">// print_field</span></div><div class="line"></div><div class="line"><span class="comment">// Task registration is as usual...</span></div><div class="line"></div><div class="line"><a class="code" href="group__execution.html#ga4dcd75ac370388c816b99672d589c4bc">flecsi_register_task</a>(print_field, <a class="code" href="namespaceexample.html">example</a>, loc, single);</div><div class="line"></div><div class="line">} <span class="comment">// namespace example</span></div><div class="line"></div><div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceflecsi.html">flecsi</a> {</div><div class="line"><span class="keyword">namespace </span>execution {</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="hpx_2runtime__driver_8h.html#a529faee76b6bf740ce1a013919b3654f">driver</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** argv) {</div><div class="line"></div><div class="line">  <span class="comment">// Get data handles to the client and field</span></div><div class="line"></div><div class="line">  <span class="keyword">auto</span> m = <a class="code" href="group__data.html#ga9673dfe687ab0a65683d20689bd9cc46">flecsi_get_client_handle</a>(<a class="code" href="structflecsi_1_1tutorial_1_1specialization__mesh__t.html">mesh_t</a>, clients, mesh);</div><div class="line">  <span class="keyword">auto</span> f = <a class="code" href="group__data.html#gaa8a47aa981f998c81433eece3206e5f0">flecsi_get_handle</a>(m, <a class="code" href="namespaceexample.html">example</a>, <a class="code" href="structflecsi_1_1accessor__u_3_01data_1_1dense_00_01T_00_01EXCLUSIVE__PERMISSIONS_00_01SHARED__PEb133ab9348c8454ebc6464fc890c46f5.html">field</a>, <span class="keywordtype">double</span>, dense, 0);</div><div class="line"></div><div class="line">  <span class="comment">// Task execution is as usual...</span></div><div class="line"></div><div class="line">  <a class="code" href="group__execution.html#gafca967e833f6d2dffd7d326c5993964f">flecsi_execute_task</a>(initialize_field, <a class="code" href="namespaceexample.html">example</a>, single, m, f);</div><div class="line">  <a class="code" href="group__execution.html#gafca967e833f6d2dffd7d326c5993964f">flecsi_execute_task</a>(print_field, <a class="code" href="namespaceexample.html">example</a>, single, m, f);</div><div class="line"></div><div class="line">} <span class="comment">// driver</span></div><div class="line"></div><div class="line">} <span class="comment">// namespace execution</span></div><div class="line">} <span class="comment">// namespace flecsi</span></div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
